name: Test

on: [pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v1

      - name: SSH
        run: |
          mkdir -p ~/.ssh/
          echo "${{ secrets.SSH_PRIV_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          mkdir -p .ddev/homeadditions/.ssh
          echo "${{ secrets.SSH_PRIV_KEY }}" > .ddev/homeadditions/.ssh/id_rsa
          chmod 700 .ddev/homeadditions/.ssh
          chmod 600 .ddev/homeadditions/.ssh/id_rsa

      - name: Setup DDEV
        uses: ddev/github-action-setup-ddev@v1

      - run: ddev describe

      - run: ddev composer install
      - run: ddev npm install

      - run: ddev pull drush -y

      - run: cypress install

      - run: npm run serve &

      - run: npm test
