# Preprocessing Fields in Drupal 8

## NOTE: WHEN IN DOUBT

NOVA and JJC are existing Drupal 8 clients that use a wide range of approaches to various field types and component combinations.

I recommend using either of those codebases as examples if you are not sure how to approach something.

## Text field (formatted and plain)

`$variables['heading'] = $node->get('title')->value;`

## Image field

`image_url` returns a fully qualified url of the image. It takes three parameters: 
- Entity, Field Name, Image Style 

`$variables['thumbnail'] = image_url($node, 'field_thumbnail', 'thumbnail');`

`<img src="{{thumbnail}}" />`

### Alt Text

`$variables['thumbnail_alt'] = $node->field_thumbnail->alt;`

## File field

`file_url` returns a fully qualified url of the file. It takes two parameters:
- Entity, Field Name

`$variables['stories_webm'] = file_url($node, 'field_stories_webm');`

## Media field

Pulls a media entity rather than just a simple image or file.

### Image

`$variables['image'] = media_url($paragraph, 'field_background', 'full_width');`

### File

`$variables['mp4'] = mediafile_url($paragraph, 'field_mp4');`

## Link

Saves markup for the link to a variable as well as creates other variables if data from the link needs put into other areas, like the url and title.

Can be output like `{{link}}`

````
$variables['link'] = '';

if (!$paragraph->field_link->isEmpty()) {
    $link = $paragraph->get('field_link')->first();

    $variables['link_url'] = l_url($link);
    $variables['link_title'] = $link->title;

    $attr = l_attr($link);

    $variables['link'] = ra(lm(
        $variables['link_title'],
        $variables['link_url'],
        'arrow',
        array_merge(
            array(
                'class' => array(
                    'impact-item__link'
                )
            ),
            $attr->toArray()
        )));

    $variables['link_attr'] = $attr;
}
````

## Paragraphs

Paragraphs are the best way to do repeatable sets of fields in Drupal 8.

They have their own preprocessing and templates.

`load_paragraphs` takes the raw field value and generates the markup of all the paragraphs contained in it.

You can also provide a view mode as a second parameter to control the rendered output.

````
$value_boxes = $node->field_value_boxes;
$variables['value_boxes'] = load_paragraphs($value_boxes, 'teaser');
````

## Nodes

Rendering a node reference field is similar to rendering a paragraph.

You can also provide a view mode as a second parameter to control the rendered output.

````
$stories = $node->get('field_stories');
foreach ($stories as $story) {

    $variables['stories'][] = load_node($story->target_id, 'teaser');

}
````

## Results

Under `/php/custom` are several finder helpers to retrieve result sets of nodes from Drupal.

`finder.php` has documentation of use within the preprocessor.

Pagination for result sets is generated by a function under content.php.

